<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/WEB-INF/templates/baseTemplate.xhtml">

	<!-- Filters -->
	<ui:define name="filterContent">
		<h:form id="filterForm" prependId="true">
			<div class="ui-grid ui-grid-responsive" style="max-width: 800px;">
				<!-- Artist Filter -->
				<div class="ui-grid-row">
					<div class="ui-grid-col-2" style="padding: 5px;">
						<h:outputLabel id="artistFilterLabel" value="#{msg.artists}"
							for="artistFilter" />
					</div>
					<div class="ui-grid-col-10" style="padding: 5px;">
						<p:selectCheckboxMenu label="#{msg.pleaseChoose}"
							id="artistFilter" value="#{performanceFilterBean.artistIds}"
							filter="true" filterMatchMode="contains"
							converter="#{performanceSupport.artistItemConverter}"
							scrollHeight="300" panelStyle="width:400px" caseSensitive="false"
							required="false" style="width:200px;">

							<f:selectItems value="#{performanceSupport.artistItems}"
								var="item" />

						</p:selectCheckboxMenu>
					</div>
				</div>
				<!-- Venue Filter -->
				<div class="ui-grid-row">
					<div class="ui-grid-col-2" style="padding: 5px;">
						<h:outputLabel id="venueFilterLabel" value="#{msg.venues}"
							for="venueFilter" />
					</div>
					<div class="ui-grid-col-10" style="padding: 5px;">
						<p:selectCheckboxMenu id="venueFilter" label="#{msg.pleaseChoose}"
							value="#{performanceFilterBean.venueIds}" filter="true"
							filterMatchMode="contains"
							converter="#{performanceSupport.venueItemConverter}"
							scrollHeight="300" panelStyle="width:400px" caseSensitive="false"
							style="width:200px;">

							<f:selectItems value="#{performanceSupport.venueItems}"
								var="item" />

						</p:selectCheckboxMenu>
					</div>
				</div>
				<!-- Date Filter -->
				<div class="ui-grid-row">
					<div class="ui-grid-col-2" style="padding: 5px;">
						<h:outputLabel id="fromToCalendarFilterLabel" value="#{msg.date}"
							for="calendarFilter" />
					</div>
					<div class="ui-grid-col-10" style="padding: 5px;">
						<p:calendar id="calendarFilter"
							value="#{performanceFilterBean.fromDate}"
							locale="#{languageBean.locale}"
							mindate="#{performanceFilterBean.minDate}"
							maxdate="#{performanceFilterBean.maxDate}" pattern="dd.MM.yyyy" />
					</div>
				</div>
			</div>
			<!-- Filter Actions -->
			<div class="ui-grid-row">
				<div class="ui-grid-col-12" style="padding: 5px;">
					<p:commandButton id="filterButton" value="#{msg.filter}"
						action="#{performanceFilterBean.filter()}" process="@form"
						global="true" update=":performancesForm" />
					<p:commandButton id="resetButton" value="#{msg.reset}"
						action="#{performanceFilterBean.clear()}"
						style="margin-left:10px;" process="@this" global="true"
						update="@form, :performancesForm" />
				</div>
			</div>
		</h:form>
	</ui:define>

	<!-- Performances -->
	<ui:define name="centerContent">
		<h:form id="performancesForm" prependId="true">
			<ui:repeat id="performanceDays"
				rendered="#{not empty performancePage.tables}"
				value="#{performancePage.tables}" var="item">


				<p:dataTable id="performanceTable" value="#{item}" var="row"
					scrollWidth="100%" paginator="true" rows="10"
					rowStatePreserved="true" reflow="true"
					rowsPerPageTemplate="10, 20, 30, 40, 50, 100" lazy="true"
					paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
					caseSensitiveSort="false" disabledSelection="true"
					disabledTextSelection="true" filterEvent="enter"
					style="text-align: center; vertical-align: middle;">

					<f:facet name="header">
						<h:outputText value="#{item.header}" />
						<p:commandLink id="newLink" title="CLICK FOR NEW"
							actionListener="#{performanceEditDialog.init(null)}"
							global="true" update=":dialogGroup" process="@this"
							oncomplete="PF('editPerformanceDialog').show();">
							<p:graphicImage id="newIcon" rendered="#{utxModel.logged}"
								library="images" name="edit_25_25.png" title="EDIT HERE"
								style="margin-left: 10px;">
							</p:graphicImage>
							<p:resetInput target=":dialogGroup" />
						</p:commandLink>
					</f:facet>
					<p:ajax event="filter" process="@this" partialSubmit="true" />

					<p:column sortable="true" sortBy="#{row.venue.label}"
						filterable="true" filterBy="#{row.venue.label}"
						style="text-align: left;">
						<f:facet name="header">
							<h:outputText value="#{msg.venue}" style="margin-right: 10px;" />
							<p:commandLink action="#{venueInfoDialog.init(null)}"
								global="true" process="@this" update=":dialogGroup"
								title="#{msg.openVenueDialog}"
								oncomplete="PF('venueInfoDialog').show();">
								<p:graphicImage library="images" name="maps_25_25.png" />
							</p:commandLink>
						</f:facet>
						<p:commandLink id="venueInfoLink" title="#{msg.openVenueDialog}"
							actionListener="#{venueInfoDialog.init(row.venue.id)}"
							global="true" update=":dialogGroup" process="@this"
							oncomplete="PF('venueInfoDialog').show();"
							style="margin-right: 10px;">
							<p:graphicImage library="images" name="maps_25_25.png" />
						</p:commandLink>
						<h:outputText value="#{row.venue.label}" />
					</p:column>

					<p:columns value="#{item.columns}" var="column"
						columnIndexVar="idxVar" filterable="true" filterBy="#{idxVar}"
						sortable="true" sortBy="#{idxVar}" headerText="#{column.header}">
						<ui:param name="model"
							value="#{row.getModelForColumn(column.startHour)}" />
						<h:panelGroup rendered="#{not empty model}">
							<p:commandLink id="infoLink" title="CLICK FOR OPEN DETAILS"
								actionListener="#{artistInfoDialog.init(model.id)}"
								global="true" update=":dialogGroup" process="@this"
								oncomplete="PF('artistInfoDialog').show();">
								<h:outputText value="#{model.name}" style="float: left;" />
							</p:commandLink>
							<p:commandLink id="editLink" title="CLICK FOR EDIT"
								actionListener="#{performanceEditDialog.init(model)}"
								global="true" update=":dialogGroup" process="@this"
								oncomplete="PF('editPerformanceDialog').show();">
								<p:graphicImage id="editIcon" rendered="#{utxModel.logged}"
									library="images" name="edit_25_25.png" title="EDIT HERE"
									style="margin-left: 10px;">
								</p:graphicImage>
								<p:resetInput target=":dialogGroup" />
							</p:commandLink>
							<p:graphicImage id="warningIcon" rendered="#{model.moved}"
								library="images" name="warn.png" width="25" height="25"
								title="HAS BEEN MOVED" style="margin-left: 10px;">
							</p:graphicImage>
						</h:panelGroup>
						<br />
					</p:columns>
				</p:dataTable>
			</ui:repeat>
		</h:form>
		<pe:tooltip value="#{msg.triggerSearchOnEnter}" shared="true"
			atPosition="top center" myPosition="bottom center"
			for="@(th .ui-column-filter.ui-inputfield.ui-inputtext)" />
		<h:panelGroup id="noPerformancesGroup" layout="block"
			rendered="#{empty performancePage.tables}">
			<h:outputText value="NO PERFORMANCES" />
		</h:panelGroup>
	</ui:define>

	<!-- Dialogs -->
	<ui:define name="dialogContent">
		<h:form id="artistDialogForm" prependId="true">
			<p:dialog id="artistInfoDialogID"
				rendered="#{not empty artistInfoDialog.artist}"
				widgetVar="artistInfoDialog" closable="true" closeOnEscape="true"
				draggable="true" responsive="true" fitViewport="true"
				position="center" header="#{msg.artist}" modal="true" minWidth="600"
				minHeight="250">

				<p:ajax event="close" listener="#{artistInfoDialog.onClose}"
					global="true" async="true" partialSubmit="true" process="@this"
					update=":artistDialogForm, :dialogGroup" />

				<h:panelGroup layout="block" style="margin: 10px;">
					<p:graphicImage value="#{artistInfoDialog.artist.streamedContent}"
						cache="false" width="150" height="200" style="float: left;" />
					<h:panelGrid id="userInfoAttributesGrid" columns="2" border="0"
						cellpadding="10">

						<h:outputText value="#{msg.firstName}" />
						<h:outputText value="#{artistInfoDialog.artist.firstName}" />

						<h:outputText value="#{msg.lastName}" />
						<h:outputText value="#{artistInfoDialog.artist.lastName}" />

						<h:outputText value="#{msg.email}" />
						<h:outputText value="#{artistInfoDialog.artist.email}" />

						<h:outputText value="#{msg.artistGroup}" />
						<h:outputText value="#{artistInfoDialog.artist.artistGroup}" />

						<h:outputText value="#{msg.country}" />
						<h:outputText
							value="#{artistInfoDialog.artist.getCountryName(languageBean.locale)}" />

						<h:outputText value="#{msg.url}" />
						<h:column>
							<h:outputLink rendered="#{not empty artistInfoDialog.artist.url}"
								value="#{artistInfoDialog.artist.url}" />
						</h:column>
					</h:panelGrid>
				</h:panelGroup>
			</p:dialog>
		</h:form>

		<h:form id="venueDialogForm" prependId="true">
			<p:dialog id="venueInfoDialogID"
				rendered="#{not empty venueInfoDialog.venues}"
				widgetVar="venueInfoDialog" closable="true" closeOnEscape="true"
				draggable="true" responsive="true" fitViewport="true"
				resizable="false" position="center" header="#{msg.venues}"
				modal="true" width="630" style="padding: 10px;">

				<p:ajax event="close" listener="#{venueInfoDialog.onClose}"
					global="true" async="true" partialSubmit="true" process="@this"
					update=":venueDialogForm, :dialogGroup" />

				<h:panelGroup id="mapContainer" layout="block"
					style="width:600px; height:300px; margin-bottom: 10px;">
					<p:gmap id="venueMap" widgetVar="venueMap"
						center="#{venueInfoDialog.defaultLocation}" zoom="15"
						type="ROADMAP" model="#{venueInfoDialog.map}"
						style="width:100%; height:100%;">
						<p:ajax event="overlaySelect"
							listener="#{venueInfoDialog.onMarkerSelect}" update="@none" />
					</p:gmap>
				</h:panelGroup>

				<p:carousel id="performancesList" headerText="#{msg.performances}"
					value="#{venueInfoDialog.venues}" var="venue" numVisible="1"
					responsive="true" easing="easeOutBounce" cricular="false"
					firstVisible="0" widgetVar="venueCarousel"
					itemStyle="width: 100%; padding: 10px;">

					<h:panelGroup layout="block" style="margin-bottom: 10px;">
						<h:outputText value="#{venue.name}"
							style="font-weight: bold; font-size: medium; " />
					</h:panelGroup>
					<ui:repeat value="#{venue.performances}" var="item">
						<div class="ui-grid ui-grid-responsive">
							<div class="ui-grid-row">
								<div class="ui-grid-col-6" style="padding: 5px;">
									<h:outputText id="startDate" value="#{item.startDate.time}">
										<f:convertDateTime type="time" locale="#{languageBean.locale}"
											for="startDate" timeZone="#{defaultTimeZone}" />
									</h:outputText>
									<h:outputText value=" - " style="margin-left: 5px;" />
									<h:outputText id="endDate" value="#{item.endDate.time}"
										style="margin-left: 5px">
										<f:convertDateTime type="time" locale="#{languageBean.locale}"
											for="startDate" timeZone="#{defaultTimeZone}" />
									</h:outputText>
								</div>
								<div class="ui-grid-col-6" style="padding: 5px;">
									<h:outputText value="(#{item.name})" />
								</div>
							</div>
						</div>
					</ui:repeat>
				</p:carousel>
			</p:dialog>
		</h:form>

		<h:form id="editPerformanceMove" prependId="true">
			<p:dialog id="editPerformanceDialogID"
				rendered="#{(utxModel.logged) and (performanceEditDialog.started)}"
				widgetVar="editPerformanceDialog" closable="true"
				closeOnEscape="true" draggable="true" responsive="true"
				fitViewport="true" resizable="false" position="center"
				header="#{msg.performance}" modal="true" width="530"
				style="padding: 10px;">

				<p:ajax event="close" listener="#{performanceEditDialog.onClose()}"
					global="true" async="true" partialSubmit="true" process="@this"
					update=":venueDialogForm, :dialogGroup" />

				<h:panelGroup id="formContainer"
					styleClass="ui-grid ui-grid-responsive" style="max-width: 800px;">
					<div class="ui-grid-row">
						<div class="ui-grid-col-12" style="padding: 5px;">
							<p:message for="formContainer" />
						</div>
					</div>
					<!-- Artist -->
					<div class="ui-grid-row">
						<div class="ui-grid-col-4" style="padding: 5px;">
							<h:outputLabel id="artistLabel" value="#{msg.artist}"
								for="artist" />
						</div>
						<div class="ui-grid-col-7" style="padding: 5px;">
							<p:selectOneMenu label="#{msg.pleaseChoose}" id="artist"
								value="#{performanceEditViewModel.artist}" filter="true"
								filterMatchMode="contains"
								converter="#{performanceSupport.artistItemConverter}"
								scrollHeight="300" panelStyle="width:400px"
								caseSensitive="false" required="true" style="width:90%;">

								<f:selectItem itemLabel="#{msg.pleaseChoose}"
									itemValue="#{null}" />
								<f:selectItems value="#{performanceSupport.artistItems}"
									var="item" />

							</p:selectOneMenu>
						</div>
						<div class="ui-grid-col-1" style="padding: 5px;">
							<p:message for="artist" display="icon" />
						</div>
					</div>
					<!-- Venue -->
					<div class="ui-grid-row">
						<div class="ui-grid-col-4" style="padding: 5px;">
							<h:outputLabel id="venueLabel" value="#{msg.venue}" for="venue" />
						</div>
						<div class="ui-grid-col-7" style="padding: 5px;">
							<p:selectOneMenu id="venue" label="#{msg.pleaseChoose}"
								value="#{performanceEditViewModel.venue}" filter="true"
								filterMatchMode="contains" required="true"
								converter="#{performanceSupport.venueItemConverter}"
								scrollHeight="300" panelStyle="width:400px" caseSensitive="true"
								style="width:90%;">

								<f:selectItem itemLabel="#{msg.pleaseChoose}"
									itemValue="#{null}" />
								<f:selectItems value="#{performanceSupport.venueItems}"
									var="item" />

							</p:selectOneMenu>
						</div>
						<div class="ui-grid-col-1" style="padding: 5px;">
							<p:message for="venue" display="icon" />
						</div>
					</div>
					<!-- Date -->
					<div class="ui-grid-row">
						<div class="ui-grid-col-4" style="padding: 5px;">
							<h:outputLabel id="dateLabel" value="#{msg.date}" for="date" />
						</div>
						<div class="ui-grid-col-7" style="padding: 5px;">
							<p:calendar id="date"
								value="#{performanceEditViewModel.date.time}"
								locale="#{languageBean.locale}"
								mindate="#{performanceEditDialog.minDate.time}"
								maxdate="#{performanceEditDialog.maxDate.time}"
								pattern="dd.MM.yyyy" style="width:90%;" />
						</div>
						<div class="ui-grid-col-1" style="padding: 5px;">
							<p:message for="date" display="icon" />
						</div>
					</div>
					<!-- Time -->
					<div class="ui-grid-row">
						<div class="ui-grid-col-4" style="padding: 5px;">
							<h:outputLabel id="timeLabel" value="#{msg.time}" for="date" />
						</div>
						<div class="ui-grid-col-7" style="padding: 5px;">
							<p:spinner id="fromHour" value="#{performanceEditViewModel.hour}"
								min="#{performanceEditDialog.startHour}" max="23" stepFactor="1"
								suffix=":00" />
						</div>
						<div class="ui-grid-col-1" style="padding: 5px;">
							<p:message for="date" display="icon" />
						</div>
					</div>
				</h:panelGroup>
				<!-- Filter Actions -->
				<div class="ui-grid-row">
					<div class="ui-grid-col-12"
						style="padding: 5px; text-align: center;">
						<p:commandButton id="saveButton"
							value="#{(not empty performanceEditViewModel.id) ? msg.save : msg.create}"
							actionListener="#{performanceEditDialog.save()}"
							process="formContainer" global="true" update="formContainer"
							style="margin-right: 10px;" />
						<p:commandButton id="deleteButton"
							rendered="#{not empty performanceEditViewModel.id}"
							value="#{msg.delete}"
							actionListener="#{performanceEditDialog.delete()}"
							process="formContainer" global="true" update="formContainer"
							style="margin-right: 10px;" />
						<p:commandButton id="closeButton" value="#{msg.close}"
							type="button" onclick="PF('editPerformanceDialog').hide();" />
					</div>
				</div>
			</p:dialog>
		</h:form>
	</ui:define>
</ui:composition>
